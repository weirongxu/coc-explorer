# coc-explorer

Explorer extension for [coc.nvim](https://github.com/neoclide/coc.nvim)

**Note: Still under development, maybe has some breaking changes.**

[![Build Status](https://travis-ci.com/weirongxu/coc-explorer.svg?branch=master)](https://travis-ci.com/weirongxu/coc-explorer)

## Screenshot

![image](https://user-images.githubusercontent.com/1709861/64966850-1e9f5100-d8d2-11e9-9490-438c6d1cf378.png)

## Requirements

`>= vim 8.0` or `>= neovim 0.3.1`

## Usage

1. Install by coc.nvim command:
   ```
   :CocInstall coc-explorer
   ```
2. Configuration custom vim mapping
   ```
   :nmap <space>e :CocCommand explorer<CR>
   ```
3. Open explorer
   ```
   <space>e
   ```
4. Press `?` to show mappings help

## Feature

- [x] Buffer source
  - [x] Highlight visible buffers in real time (neovim only)
- [x] File tree source
  - [x] Basic actions
    - [x] Open file in select / vsplit / tab  
           `explorer.openAction.strategy` options:
      - select: Open action use selection UI
      - vsplit: Open action with vsplit
      - previousBuffer: Open action use last used buffer
      - previousWindow: Open action use last used window
      - sourceWindow: Open action use the window when opening explorer
    - [x] Selection
    - [x] Cut / Copy / Paste
    - [x] Delete action use trash by default
  - [x] Git status
  - [x] Highlight current buffer in real time (neovim only)
  - [x] Icons, use [nerdfont](https://github.com/ryanoasis/nerd-fonts)
  - [x] Search files by Coc-list
  - [ ] LSP
    - [x] diagnostic
    - [ ] file rename
  - [ ] Exrename, like [defx](https://github.com/Shougo/defx.nvim)
  - [ ] Archive file (use `lsar / unar`)
  - [ ] SSH
- [ ] Git source
  - [ ] Git actions
- [x] Show help

## Command

```
:CocCommand explorer [options] [root-path]
```

### Example

```
:CocCommand explorer
    \ --toggle
    \ --sources=buffer+,file+
    \ --file-columns=git:selection:clip:diagnosticError:indent:icon:filename;fullpath;size;modified;readonly /root/path
```

### Options

#### `[root-path]`

Explorer root, default:

- `getcwd()` when `buftype` is `nofile`
- `workspace.rootPath`

#### `--sources <sources>`

Explorer sources, example: `buffer+,file+`, default: `buffer-,file+`

#### `--toggle | --no-toggle`

Close the explorer if it exists, default: `--toggle`

#### `--width <number>`

Explorer window width, default: `40`

#### `--position <position>`

Explorer position, supported position: `left`, `right`, `tab`, default: `left`

#### `--reveal <filepath>`

Explorer will expand to this filepath, default: `current buffer`

#### `--buffer-columns <buffer-columns>`

Explorer buffer columns, supported columns:

- selection
- name
- bufname
- modified
- bufnr

Use columns with label for floating preview, same with `--file-columns`

#### `--file-columns <file-columns>`

Explorer file columns, supported columns:

- git
- selection
- icon
- filename
- indent
- clip
- size
- diagnosticError
- diagnosticWarning
- created
- modified
- accessed

Use columns with label for floating preview

```
--file-columns=selection:clip:indent:icon:filename;fullpath;size;modified;readonly

selection:clip:indent:icon:filename # explorer
fullpath;size;modified;readonly # floating preview
```

![image](https://user-images.githubusercontent.com/1709861/72122161-f616f780-3397-11ea-8dd2-e80278e6f1a0.png)

The columns are designed in two parts, split by first `;`, then the first part is used to display in the explorer, and the second part is used to display in floating-preview with label.

## Configuration

<!-- Generated by 'yarn run gen:doc', please don't edit it directly -->
<!-- prettier-ignore -->
<details>
<summary><code>explorer.keyMappingMode</code>: Keymapping mode. type: <code>none | default</code></summary>
Default: <pre><code>"default"</code></pre>
</details>
<details>
<summary><code>explorer.keyMappings</code>: Custom keymappings. type: <code>object</code></summary>
Default: <pre><code>{}</code></pre>
</details>
<details>
<summary><code>explorer.position</code>: Explorer position. type: <code>left | right | tab</code></summary>
Default: <pre><code>"left"</code></pre>
</details>
<details>
<summary><code>explorer.width</code>: Explorer window width for open in left or right side. type: <code>number</code></summary>
Default: <pre><code>40</code></pre>
</details>
<details>
<summary><code>explorer.toggle</code>: Close the explorer if it exists. type: <code>boolean</code></summary>
Default: <pre><code>true</code></pre>
</details>
<details>
<summary><code>explorer.autoExpandSingleNode</code>: Automatically expand next node when it's a single node. type: <code>boolean</code></summary>
Default: <pre><code>true</code></pre>
</details>
<details>
<summary><code>explorer.autoCollapseChildren</code>: Automatically collapse children. type: <code>boolean</code></summary>
Default: <pre><code>true</code></pre>
</details>
<details>
<summary><code>explorer.activeMode</code>: Render explorer when after open or save buffer. type: <code>boolean</code></summary>
Default: <pre><code>true</code></pre>
</details>
<details>
<summary><code>explorer.quitOnOpen</code>: quit explorer when open action. type: <code>boolean</code></summary>
Default: <pre><code>false</code></pre>
</details>
<details>
<summary><code>explorer.previewAction.strategy</code>: Strategy for preview action. type: <code>labeling</code></summary>
Default: <pre><code>"labeling"</code></pre>
</details>
<details>
<summary><code>explorer.previewAction.onHover</code>: Open preview when hovering over on node. type: <code>boolean</code></summary>
Default: <pre><code>false</code></pre>
</details>
<details>
<summary><code>explorer.openAction.strategy</code>: Strategy for open action. type: <code>select | vsplit | previousBuffer | previousWindow | sourceWindow</code></summary>
Default: <pre><code>"select"</code></pre>
</details>
<details>
<summary><code>explorer.openAction.select.filterFloatWindows</code>: Filter floating windows in select strategy. type: <code>boolean</code></summary>
Default: <pre><code>true</code></pre>
</details>
<details>
<summary><code>explorer.openAction.changeDirectory</code>: Change directory if node is a directory. type: <code>boolean</code></summary>
Default: <pre><code>true</code></pre>
</details>
<details>
<summary><code>explorer.sources</code>: Explorer sources. type: <code>array</code></summary>
Default: <pre><code>[
  {
    "name": "buffer",
    "expand": false
  },
  {
    "name": "file",
    "expand": true
  }
]</code></pre>
</details>
<details>
<summary><code>explorer.icon.enableNerdfont</code>: Enable nerdfont. type: <code>boolean</code></summary>
Default: <pre><code>false</code></pre>
</details>
<details>
<summary><code>explorer.icon.customIcons</code>: Custom icons and color highlights. type: <code>object</code></summary>
Default: <pre><code>{
  "icons": {},
  "extensions": {},
  "filenames": {},
  "patternMatches": {}
}</code></pre>
</details>
<details>
<summary><code>explorer.icon.enableVimDevions</code>: Enable use vim-devicons instead of built-in icon configuration. type: <code>boolean</code></summary>
Default: <pre><code>false</code></pre>
</details>
<details>
<summary><code>explorer.icon.expanded</code>: Icon for expanded node. type: <code>string</code></summary>
Default: <pre><code>"-"</code></pre>
</details>
<details>
<summary><code>explorer.icon.collapsed</code>: Icon for collapsed node. type: <code>string</code></summary>
Default: <pre><code>"+"</code></pre>
</details>
<details>
<summary><code>explorer.icon.selected</code>: Selection selected chars for File source. type: <code>string</code></summary>
Default: <pre><code>"âœ“"</code></pre>
</details>
<details>
<summary><code>explorer.icon.unselected</code>: Selection unselected chars for File source. type: <code>string</code></summary>
Default: <pre><code>" "</code></pre>
</details>
<details>
<summary><code>explorer.icon.hidden</code>: Icon for hidden status. type: <code>string</code></summary>
Default: <pre><code>"I"</code></pre>
</details>
<details>
<summary><code>explorer.buffer.showHiddenBuffers</code>: Default show hidden buffers. type: <code>boolean</code></summary>
Default: <pre><code>false</code></pre>
</details>
<details>
<summary><code>explorer.buffer.columns</code>: Default columns for buffer source. type: <code>array</code></summary>
Default: <pre><code>[
  "selection",
  "bufnr",
  "name",
  "modified",
  "readonly",
  "fullpath",
  [
    "bufname"
  ],
  [
    "fullpath"
  ],
  [
    "modified"
  ],
  [
    "readonly"
  ]
]</code></pre>
</details>
<details>
<summary><code>explorer.datetime.format</code>: Explorer datetime format, check out https://github.com/iamkun/dayjs/blob/dev/docs/en/API-reference.md#format-formatstringwithtokens-string. type: <code>string</code></summary>
Default: <pre><code>"YY/MM/DD HH:mm:ss"</code></pre>
</details>
<details>
<summary><code>explorer.file.autoReveal</code>: Explorer will automatically expand to the current buffer. type: <code>boolean</code></summary>
Default: <pre><code>true</code></pre>
</details>
<details>
<summary><code>explorer.file.diagnosticCountMax</code>: Maximum count of diagnostic column. type: <code>number</code></summary>
Default: <pre><code>99</code></pre>
</details>
<details>
<summary><code>explorer.file.hiddenRules</code>: Custom hidden rules for file. type: <code>object</code></summary>
Default: <pre><code>{
  "extensions": [
    "o",
    "a",
    "obj",
    "pyc"
  ],
  "filenames": [],
  "patternMatches": [
    "^\\."
  ]
}</code></pre>
</details>
<details>
<summary><code>explorer.file.showHiddenFiles</code>: Default show hidden files. type: <code>boolean</code></summary>
Default: <pre><code>false</code></pre>
</details>
<details>
<summary><code>explorer.file.columns</code>: Default columns for file source. type: <code>array</code></summary>
Default: <pre><code>[
  "git",
  "selection",
  "clip",
  "diagnosticError",
  "indent",
  "icon",
  "filename",
  "size",
  "modified",
  "readonly",
  [
    "fullpath"
  ],
  [
    "size"
  ],
  [
    "accessed"
  ],
  [
    "modified"
  ],
  [
    "created"
  ],
  [
    "readonly"
  ]
]</code></pre>
</details>
<details>
<summary><code>explorer.file.column.git.showIgnored</code>: Show ignored files in git column. type: <code>boolean</code></summary>
Default: <pre><code>false</code></pre>
</details>
<details>
<summary><code>explorer.file.column.git.icon.mixed</code>: Icon for git mixed status. type: <code>string</code></summary>
Default: <pre><code>"*"</code></pre>
</details>
<details>
<summary><code>explorer.file.column.git.icon.unmodified</code>: Icon for git unmodified status. type: <code>string</code></summary>
Default: <pre><code>" "</code></pre>
</details>
<details>
<summary><code>explorer.file.column.git.icon.modified</code>: Icon for git modified status. type: <code>string</code></summary>
Default: <pre><code>"M"</code></pre>
</details>
<details>
<summary><code>explorer.file.column.git.icon.added</code>: Icon for git added status. type: <code>string</code></summary>
Default: <pre><code>"A"</code></pre>
</details>
<details>
<summary><code>explorer.file.column.git.icon.deleted</code>: Icon for git removed status. type: <code>string</code></summary>
Default: <pre><code>"D"</code></pre>
</details>
<details>
<summary><code>explorer.file.column.git.icon.renamed</code>: Icon for git renamed status. type: <code>string</code></summary>
Default: <pre><code>"R"</code></pre>
</details>
<details>
<summary><code>explorer.file.column.git.icon.copied</code>: Icon for git copied status. type: <code>string</code></summary>
Default: <pre><code>"C"</code></pre>
</details>
<details>
<summary><code>explorer.file.column.git.icon.unmerged</code>: Icon for git unmerged status. type: <code>string</code></summary>
Default: <pre><code>"U"</code></pre>
</details>
<details>
<summary><code>explorer.file.column.git.icon.untracked</code>: Icon for git untracked status. type: <code>string</code></summary>
Default: <pre><code>"?"</code></pre>
</details>
<details>
<summary><code>explorer.file.column.git.icon.ignored</code>: Icon for git ignored status. type: <code>string</code></summary>
Default: <pre><code>"!"</code></pre>
</details>
<details>
<summary><code>explorer.file.column.clip.copy</code>: Whether the file has been copied. type: <code>string</code></summary>

</details>
<details>
<summary><code>explorer.file.column.clip.cut</code>: Whether the file has been cut. type: <code>string</code></summary>

</details>
<details>
<summary><code>explorer.file.column.indent.chars</code>: Indent chars for file source. type: <code>string</code></summary>
Default: <pre><code>"  "</code></pre>
</details>
<details>
<summary><code>explorer.file.column.indent.topLevel</code>: Whether to indent it in top level. type: <code>boolean</code></summary>
Default: <pre><code>false</code></pre>
</details>
<details>
<summary><code>explorer.file.column.indent.indentLine</code>: Whether to display the alignment line. type: <code>boolean</code></summary>

</details>
<details>
<summary><code>explorer.file.column.filename.width</code>: Filename with. type: <code>integer</code></summary>
Default: <pre><code>80</code></pre>
</details>
<details>
<summary><code>explorer.file.column.filename.paddingEnd</code>: Enable filename padding end. type: <code>boolean</code></summary>
Default: <pre><code>true</code></pre>
</details>
<details>
<summary><code>explorer.git.command</code>: Git command. type: <code>string</code></summary>
Default: <pre><code>"git"</code></pre>
</details>
<details>
<summary><code>explorer.debug</code>: Enable debug. type: <code>boolean</code></summary>
Default: <pre><code>false</code></pre>
</details>

## Custom mappings example

```jsonc
// coc-settings.json
{
  "explorer.keyMappings": {
    "k": "nodePrev",
    "j": "nodeNext",

    "*": "toggleSelection",
    "<tab>": "actionMenu",

    "h": "collapse",
    "l": "expand",
    "J": ["toggleSelection", "normal:j"],
    "K": ["toggleSelection", "normal:k"],
    "gl": "expandRecursive",
    "gh": "collapseRecursive",
    "o": "expandOrCollapse",
    "<cr>": "open",
    "e": "open",
    "E": "openInVsplit",
    "t": "openInTab",
    "<bs>": "gotoParent",

    "y": "copyFilepath",
    "Y": "copyFilename",
    "c": "copyFile",
    "x": "cutFile",
    "p": "pasteFile",
    "d": "delete",
    "D": "deleteForever",

    "a": "addFile",
    "A": "addDirectory",
    "r": "rename",

    ".": "toggleHidden",
    "R": "refresh",

    "?": "help",
    "q": "quit",
    "X": "systemExecute",
    "gd": "listDrive",

    "f": "search",
    "F": "searchRecursive",

    "gf": "gotoSource:file",
    "gb": "gotoSource:buffer",

    "[[": "sourcePrev",
    "]]": "sourceNext",

    "[d": "diagnosticPrev",
    "]d": "diagnosticNext",

    "[c": "gitPrev",
    "]c": "gitNext",
    "<<": "gitStage",
    ">>": "gitUnstage"
  }
}
```

## Inspired by

- VSCode Explorer
- [Shougo/vimfiler.vim](https://github.com/Shougo/vimfiler.vim)
- [Shougo/defx.nvim](https://github.com/Shougo/defx.nvim)
- [lambdalisue/fila.vim](https://github.com/lambdalisue/fila.vim)
